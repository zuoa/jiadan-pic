<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šä¼ è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, textarea { width: 300px; padding: 5px; }
        button { padding: 10px 20px; margin: 10px 5px; }
        .result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .error { background-color: #ffe6e6; }
        .success { background-color: #e6ffe6; }
    </style>
</head>
<body>
    <h1>ä¸Šä¼ åŠŸèƒ½è°ƒè¯•</h1>
    
    <div class="form-group">
        <label for="tokenInput">è®¤è¯Token (ä»localStorageè·å–):</label>
        <input type="text" id="tokenInput" placeholder="å°†è‡ªåŠ¨ä»localStorageè·å–">
        <button onclick="loadToken()">è·å–Token</button>
    </div>

    <div class="form-group">
        <label for="fileInput">é€‰æ‹©å›¾ç‰‡æ–‡ä»¶:</label>
        <input type="file" id="fileInput" accept="image/*">
    </div>

    <div class="form-group">
        <label for="titleInput">æ ‡é¢˜:</label>
        <input type="text" id="titleInput" value="è°ƒè¯•æµ‹è¯•ç…§ç‰‡">
    </div>

    <div class="form-group">
        <label for="descInput">æè¿°:</label>
        <textarea id="descInput">è¿™æ˜¯ä¸€å¼ ç”¨äºè°ƒè¯•çš„æµ‹è¯•ç…§ç‰‡</textarea>
    </div>

    <div class="form-group">
        <label for="locationInput">ä½ç½®:</label>
        <input type="text" id="locationInput" value="è°ƒè¯•åœ°ç‚¹">
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" id="publicInput"> å…¬å¼€ç…§ç‰‡
        </label>
    </div>

    <button onclick="testUpload()">æµ‹è¯•ä¸Šä¼ </button>
    <button onclick="clearResult()">æ¸…é™¤ç»“æœ</button>

    <div id="result" class="result" style="display: none;"></div>

    <script>
        function loadToken() {
            const token = localStorage.getItem('admin_token');
            document.getElementById('tokenInput').value = token || 'æœªæ‰¾åˆ°token';
            console.log('Token:', token);
        }

        function clearResult() {
            const result = document.getElementById('result');
            result.style.display = 'none';
            result.innerHTML = '';
        }

        function showResult(content, isError = false) {
            const result = document.getElementById('result');
            result.innerHTML = content;
            result.className = 'result ' + (isError ? 'error' : 'success');
            result.style.display = 'block';
        }

        async function testUpload() {
            try {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];
                
                if (!file) {
                    showResult('è¯·é€‰æ‹©æ–‡ä»¶', true);
                    return;
                }

                const token = document.getElementById('tokenInput').value;
                if (!token || token === 'æœªæ‰¾åˆ°token') {
                    showResult('è¯·å…ˆè·å–æœ‰æ•ˆçš„è®¤è¯token', true);
                    return;
                }

                console.log('ğŸ“ å‡†å¤‡ä¸Šä¼ æ–‡ä»¶:', {
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    lastModified: file.lastModified
                });

                const formData = new FormData();
                formData.append('file', file, file.name);
                formData.append('title', document.getElementById('titleInput').value);
                formData.append('description', document.getElementById('descInput').value);
                formData.append('date', new Date().toISOString().split('T')[0]);
                formData.append('location', document.getElementById('locationInput').value);
                formData.append('is_public', document.getElementById('publicInput').checked.toString());

                console.log('ğŸ“¤ FormDataå†…å®¹:');
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}:`, value);
                }

                showResult('æ­£åœ¨ä¸Šä¼ ...', false);

                const response = await fetch('http://localhost:8000/api/photos/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                        // æ³¨æ„ï¼šä¸è®¾ç½®Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®
                    },
                    body: formData
                });

                console.log('ğŸ“¨ å“åº”çŠ¶æ€:', response.status, response.statusText);
                console.log('ğŸ“¨ å“åº”å¤´:', Object.fromEntries(response.headers.entries()));

                const result = await response.json();
                console.log('ğŸ“¨ å“åº”æ•°æ®:', result);

                if (response.ok) {
                    showResult(`
                        <h3>âœ… ä¸Šä¼ æˆåŠŸ!</h3>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `, false);
                } else {
                    showResult(`
                        <h3>âŒ ä¸Šä¼ å¤±è´¥ (${response.status})</h3>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `, true);
                }
            } catch (error) {
                console.error('âŒ ä¸Šä¼ å¼‚å¸¸:', error);
                showResult(`
                    <h3>âŒ ä¸Šä¼ å¼‚å¸¸</h3>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `, true);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–token
        window.onload = function() {
            loadToken();
        };
    </script>
</body>
</html> 